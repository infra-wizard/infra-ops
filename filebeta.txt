helm install filebeat elastic/filebeat -f filebeat-values.yaml
helm pull elastic/filebeat --version 8.5.1 --untar

# filebeat-values.yaml
filebeatConfig:
  filebeat.yml: |
    filebeat.inputs:
    - type: container
      paths:
        - /var/log/containers/*.log
      processors:
        - add_kubernetes_metadata:
            host: ${NODE_NAME}
            matchers:
            - logs_path:
                logs_path: "/var/log/containers/"

    output.elasticsearch:
      hosts: ["https://elasticsearch-master:9200"]
      username: "${ELASTICSEARCH_USERNAME}"
      password: "${ELASTICSEARCH_PASSWORD}"
      ssl.verification_mode: none
      index: "aks-logs-%{+yyyy.MM.dd}"
      
    setup.template.name: "aks-logs"
    setup.template.pattern: "aks-logs-*"

# Environment variables pointing to your secret
extraEnvs:
- name: ELASTICSEARCH_USERNAME
  valueFrom:
    secretKeyRef:
      name: elasticsearch-master-credentials
      key: username
- name: ELASTICSEARCH_PASSWORD
  valueFrom:
    secretKeyRef:
      name: elasticsearch-master-credentials
      key: password

# Deploy as DaemonSet to collect logs from all namespaces
daemonset:
  enabled: true
